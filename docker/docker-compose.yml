version: "3.8"

services:

  plex:
    image: lscr.io/linuxserver/plex:latest
    container_name: plex
    runtime: nvidia
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - NVIDIA_VISIBLE_DEVICES=${NVIDIA_VISIBLE_DEVICES}
      - NVIDIA_DRIVER_CAPABILITIES=${NVIDIA_DRIVER_CAPABILITIES}
    ports:
      - "${PLEX_PORT}:32400"
    volumes:
      - ${PLEX_CONFIG_PATH}:/config
      - ${PLEX_TRANSCODE_PATH}:/transcode
      - ${MEDIA_PATH}:/media
    restart: unless-stopped

  jellyfin:
    image: jellyfin/jellyfin:latest
    container_name: jellyfin
    runtime: nvidia
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - NVIDIA_VISIBLE_DEVICES=${NVIDIA_VISIBLE_DEVICES}
      - NVIDIA_DRIVER_CAPABILITIES=${NVIDIA_DRIVER_CAPABILITIES}
    ports:
      - "${JELLYFIN_PORT}:8096"
    volumes:
      - ${PROJECTS_PATH}/jellyfin/config:/config
      - ${PROJECTS_PATH}/jellyfin/cache:/cache
      - ${PLEX_TRANSCODE_PATH}/jellyfin:/transcode
      - ${MEDIA_PATH}:/media
    restart: unless-stopped

  sabnzbd:
    image: binhex/arch-sabnzbd
    container_name: sabnzbd
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    ports:
      - "${SAB_PORT}:8080"
    volumes:
      - ${PROJECTS_PATH}/sabnzbd/config:/config
      - ${DOWNLOADS_PATH}:/downloads
    restart: unless-stopped

  radarr:
    image: lscr.io/linuxserver/radarr:latest
    container_name: radarr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    ports:
      - "${RADARR_PORT}:7878"
    volumes:
      - ${PROJECTS_PATH}/radarr/config:/config
      - ${MEDIA_PATH}:/media
      - ${DOWNLOADS_PATH}:/downloads
    restart: unless-stopped

  sonarr:
    image: lscr.io/linuxserver/sonarr:latest
    container_name: sonarr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    ports:
      - "${SONARR_PORT}:8989"
    volumes:
      - ${PROJECTS_PATH}/sonarr/config:/config
      - ${MEDIA_PATH}:/media
      - ${DOWNLOADS_PATH}:/downloads
    restart: unless-stopped

  prowlarr:
    image: lscr.io/linuxserver/prowlarr:latest
    container_name: prowlarr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    ports:
      - "${PROWLARR_PORT}:9696"
    volumes:
      - ${PROJECTS_PATH}/prowlarr/config:/config
    restart: unless-stopped

  overseerr:
    image: lscr.io/linuxserver/overseerr:latest
    container_name: overseerr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    ports:
      - "${OVERSEERR_PORT}:5055"
    volumes:
      - ${PROJECTS_PATH}/overseerr/config:/config
    restart: unless-stopped

  restic:
    image: restic/restic:latest
    container_name: restic
    volumes:
      - ${PLEX_CONFIG_PATH}:/data/plexdata:ro
      - ${PROJECTS_PATH}:/data/projects:ro
      # Backup repository target (local or remote mount)
      # - /path/to/restic-repo:/repo
    entrypoint: ["sleep", "infinity"]
